set(PUBLIC_HEADERS
  include/numgeom/loadfromvtk.h
  include/numgeom/writetovtk.h
)

set(SOURCE_FILES
  ${PUBLIC_HEADERS}
  loadfromvtk.cpp
  writetovtk.cpp
)

add_library(io ${SOURCE_FILES})
add_library(numgeom::io ALIAS io)

set_target_properties(io PROPERTIES PUBLIC_HEADER "${PUBLIC_HEADERS}")

generate_export_header(io
  EXPORT_FILE_NAME ${CMAKE_CURRENT_BINARY_DIR}/include/numgeom/numgeomio_export.h
)

target_include_directories(io
  PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/include
    ${CMAKE_CURRENT_BINARY_DIR}/include
)

target_link_libraries(io
  PUBLIC
    numgeom::core
)

if(FLEX_FOUND AND BISON_FOUND)
  flex_target(vtk_scanner vtk.l ${CMAKE_CURRENT_BINARY_DIR}/vtk_scanner.c)
  bison_target(vtk_parser vtk.y ${CMAKE_CURRENT_BINARY_DIR}/vtk_parser.c)
  add_flex_bison_dependency(vtk_scanner vtk_parser)

  target_sources(io
    PRIVATE
      ${BISON_vtk_parser_OUTPUTS}
      ${FLEX_vtk_scanner_OUTPUTS}
  )

  target_include_directories(io
    PRIVATE
      ${CMAKE_CURRENT_BINARY_DIR}
  )
else()
  target_sources(io
    PRIVATE
      ${CMAKE_CURRENT_SOURCE_DIR}/autogenerated/vtk_parser.h
      ${CMAKE_CURRENT_SOURCE_DIR}/autogenerated/vtk_parser.c
      ${CMAKE_CURRENT_SOURCE_DIR}/autogenerated/vtk_scanner.c
  )

  target_include_directories(io
    PRIVATE
      ${CMAKE_CURRENT_SOURCE_DIR}/autogenerated
  )
endif()
